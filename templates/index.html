{% extends "base.html" %}



{% block css %}

<style>

/* Sticky group header */
.sticky-group-header {
  background-color: #222;
  border-radius: 10%;
  width: 50%;
  position: sticky;
  top: 0;
  z-index: 100;
  padding: 0.75rem 1rem;
  border-bottom: 1px solid #444;
}

/* Summary styling */
.group-jump-menu summary {
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  color: white;
}

/* Jump links layout */
.jump-links {
  display: flex;
  flex-direction: column;
  background-color: #222;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  margin-top: 0.5rem;
  gap: 0.5rem;
  width: 50%;
}

/* Link styling */
.jump-links a {
  font-size: 1rem;
  color: white;
  text-decoration: none;
  padding: 0.5rem 0.75rem;
  border-radius: 4px;
  background-color: #333;
  transition: background 0.2s ease;
}

.jump-links a:hover {
  background-color: #444;
}

/* ðŸ“± Mobile-specific styles */
@media (max-width: 768px) {
  .jump-links {
    font-size: 1.1rem;
    padding: 1rem;
    gap: 0.75rem;
  }

  .jump-links a {
    background-color: #222;
    padding: 0.75rem;
    font-size: 1rem;
    text-align: center;
  }
}

.task-group {
  scroll-margin-top: 5rem;
}


</style>


{% endblock %}











{% block content %}

{% for group, tasks in grouped_tasks.items %}
  {% if tasks %}
    <section id="group-{{ group|slugify }}" class="task-group">

      <header class="sticky-group-header" style="display: flex; justify-content: center; width: 80%;">
        <details class="group-jump-menu">
          <summary>{{ group }} â¬‡</summary>
          <nav class="jump-links">
            {% for jump_group, jump_tasks in grouped_tasks.items %}
              {% if jump_tasks %}
                <a href="#group-{{ jump_group|slugify }}">{{ jump_group }}</a>
              {% endif %}
            {% endfor %}
          </nav>
        </details>
      </header>

      {% for task in tasks %}
        <form method="POST" action="{% url 'toggle-task' task.id %}" class="container">
          {% csrf_token %}

          <article class="task-card" style="margin-bottom: 1rem; border-radius: 15px; padding: 1rem; width: 100%;">

            <div style="display: flex; align-items: flex-start; gap: 0.75rem;">
              {# Checkbox styling simplified with a class and conditional CSS classes #}
              <input
                type="checkbox"
                name="completed"
                onchange="this.form.submit();"
                class="circle-checkbox"
                {% if task.completed %}checked{% endif %}
                style="
                  appearance: none;
                  width: 1rem;
                  height: 1rem;
                  border-radius: 50%;
                  cursor: pointer;
                  background-color: {% if task.completed %}gray{% else %}transparent{% endif %};
                  border: 2px solid
                    {% if task.priority == 'high' and not task.completed %}red
                    {% elif task.priority == 'medium' and not task.completed %}orange
                    {% else %}gray{% endif %};
                ">
              
              <div style="flex: 1;">
                <a href="{% url 'update-task' task.id %}" style="text-decoration: none; color: white; {% if task.completed %}text-decoration: line-through; opacity: 0.6;{% endif %}">
                  {{ task.title }}
                </a>
                <br>
              </div>

            </div>

          </article>
        </form>
      {% endfor %}

    </section>
  {% endif %}
{% endfor %}




{% endblock %}














{% block scripts %}

<script>
  document.querySelectorAll('.group-jump-menu a').forEach(link => {
    link.addEventListener('click', function () {
      // Close the closest <details> when a jump link is clicked
      const details = this.closest('details');
      if (details) {
        details.removeAttribute('open');
      }
    });
  });
</script>


<script>
  document.addEventListener("click", function (event) {
    document.querySelectorAll(".group-jump-menu").forEach(details => {
      const isClickInside = details.contains(event.target);

      // Close if clicking outside
      if (!isClickInside && details.hasAttribute("open")) {
        details.removeAttribute("open");
      }
    });
  });

  // Optional: close on internal link click
  document.querySelectorAll('.group-jump-menu a').forEach(link => {
    link.addEventListener('click', function () {
      const details = this.closest('details');
      if (details) {
        details.removeAttribute('open');
      }
    });
  });
</script>


{% endblock %}